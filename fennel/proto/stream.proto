// proto2 vs proto3 - https://github.com/protocolbuffers/protobuf/releases/tag/v3.0.0
syntax = "proto3";

package fennel.proto;

import "schema.proto";

// Next field number: 6
message CreateSourceRequest {
    string name = 1;
    oneof source {
       SQL sql = 2;
       S3 s3 = 3;
       BigQuery bigquery = 4;
    }
}

// Next field number: 9
message CreateConnectorRequest {
    string name = 1;
    string source_name = 2;
    string source_type = 3;
    bytes connector_function = 4;
    string populator_src_code = 5;
    string cursor_field = 6;
    string table_name = 7;
}

message CreateStreamRequest {
    string name = 1;
    uint32 version = 2;
    // Retention in seconds
    uint32 retention = 3;
    // TODO: Use timestamp for start
    uint32 start = 4;
    // This is essentially a map of source to connectors
    // and the source and connector at a given index are related.
    repeated CreateSourceRequest sources = 5;
    repeated CreateConnectorRequest connectors = 6;
    Schema schema = 7;
}

// Next field number: 8
message SQL {
    enum SQLType {
        Postgres = 0;
        MySQL = 1;
    }
    SQLType sql_type = 1;
    string host = 2;
    string db = 3;
    string username = 4;
    string password = 5;
    uint32 port = 6;
    string jdbc_params = 7;
}

// Next field number: 6
message S3 {
    string bucket = 1;
    string path_prefix = 2;
    string aws_access_key_id = 3;
    string aws_secret_access_key = 4;
    string schema = 5;
}

// Next field number: 4
message BigQuery {
    string project_id = 1;
    string dataset = 2;
    string credentials_json = 3;
}
